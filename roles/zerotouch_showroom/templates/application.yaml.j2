---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: {{ ocp4_workload_showroom_namespace }}
  namespace: openshift-gitops
  finalizers:
  - resources-finalizer.argocd.argoproj.io
spec:
  destination:
    name: ''
    namespace: {{ ocp4_workload_showroom_namespace }}
    server: https://kubernetes.default.svc
  project: default
  syncPolicy:
    syncOptions:
    - CreateNamespace=true
    automated:
      prune: true
      selfHeal: true
  source:
    repoURL: {{ ocp4_workload_showroom_chart_package_url }}
    chart: {{ ocp4_workload_showroom_deployer_chart_name }}
    targetRevision: {{ ocp4_workload_showroom_deployer_chart_version }}
    helm:
      releaseName: {{ ocp4_workload_showroom_name }}
      values: |
        guid: {{ guid }}
        deployer:
          domain: {{ _deployer_domain }}
        terminal:
          setup: "{{ ('true' if ocp4_workload_showroom_terminal_type == 'showroom' else 'false') | string | lower }}"
          image: {{ ocp4_workload_showroom_terminal_image }}
          resources:
            requests:
              cpu: "{{ ocp4_workload_showroom_terminal_requests_cpu }}"
              memory: "{{ ocp4_workload_showroom_terminal_requests_memory }}"
            limits:
              cpu: "{{ ocp4_workload_showroom_terminal_limits_cpu }}"
              memory: "{{ ocp4_workload_showroom_terminal_limits_memory }}"
        wetty:
          setup: "{{ ('true' if ocp4_workload_showroom_terminal_type == 'wetty' else 'false') | string | lower }}"
          image: {{ ocp4_workload_showroom_wetty_image }}
          resources:
            requests:
              cpu: "{{ ocp4_workload_showroom_terminal_requests_cpu }}"
              memory: "{{ ocp4_workload_showroom_terminal_requests_memory }}"
            limits:
              cpu: "{{ ocp4_workload_showroom_terminal_limits_cpu }}"
              memory: "{{ ocp4_workload_showroom_terminal_limits_memory }}"
          ssh:
            sshHost: {{ _showroom_user_data.bastion_public_hostname }}
            autoSshToBastion: "{{ ('true' if ocp4_workload_showroom_wetty_ssh_bastion_login | bool else 'false') | string | lower }}"
            sshAuth: password
            sshUser: {{ _showroom_user_data.bastion_ssh_user_name }}
            sshPass: {{ _showroom_user_data.bastion_ssh_password }}
            sshPort: "{{ _showroom_user_data.bastion_ssh_port | default(22) }}"
        content:
          repoUrl: {{ ocp4_workload_showroom_content_git_repo }}
          repoRef: {{ ocp4_workload_showroom_content_git_repo_ref }}
          antoraPlaybook: {{ ocp4_workload_showroom_content_antora_playbook }}
          contentOnly: "{{ ocp4_workload_showroom_content_only | string | lower }}"
          user_data: |-
            {{ _showroom_user_data | to_nice_yaml | indent(12) }}
          zero_touch_bundle: "{{  ocp4_workload_showroom_zero_touch_bundle }}"
          zero_touch_ui_enabled: "{{ ocp4_workload_showroom_zero_touch_ui_enabled | string | lower }}"
        cloud:
          setup: "{{ ('false' if auth_cloud_provider | default('none') == 'none' else 'true') | string | lower }}"
          image: {{ ocp4_workload_showroom_cloud_image }}
          auth_cloud_provider: "{{ auth_cloud_provider | default('none') }}"
          aws_access_key_id: "{{ aws_sandbox_provision_data.aws_access_key_id | default('') }}"
          aws_secret_access_key: "{{ aws_sandbox_provision_data.aws_secret_access_key | default('') }}"
          azure_subscription: "{{ azure_sandbox_provision_data.azure_subscription | default('') }}"
          azure_tenant: "{{ azure_sandbox_provision_data.azure_tenant_id | default('') }}"
          azure_client_id: "{{ azure_sandbox_provision_data.azure_service_principal_id | default('') }}"
          azure_password: "{{ azure_sandbox_provision_data.azure_service_principal_password | default('') }}"
          azure_resourcegroup: "{{ azure_sandbox_provision_data.azure_resource_group | default('') }}"

