= OCP Console Embed Role

This role deploys the OCP Console Embed workload, which configures the OpenShift Console and OAuth server to allow embedding in iframes (e.g. for Showroom).

== Variables

[cols="1,1,2",options="header"]
|===
| Variable | Default | Description
| `ocp_console_embed_namespace` | `ocp-console-embed` | Namespace to deploy resources into.
| `ocp_console_embed_name` | `ocp-console-embed` | Base name for resources.
| `ocp_console_embed_image` | `registry.access.redhat.com/ubi10/python-312-minimal:10.1` | Image to use for the webhook.
| `ocp_console_embed_domain` | `""` | Base domain of the OpenShift cluster. Falls back to `openshift_cluster_ingress_domain`, `sandbox_openshift_apps_domain`, or `showroom_openshift_apps_domain`.
|===

== Description

The role deploys:
- A MutatingWebhook that intercepts Route updates to `oauth-openshift` and forces `reencrypt` TLS.
- Patches the default IngressController to strip `X-Frame-Options` and set `Content-Security-Policy`.
- Patches the `oauth-openshift` Route to use `reencrypt` TLS immediately (maintained by the webhook).

== Testing

The webhook logic is implemented in a standalone Python script located at `files/webhook.py`.
Unit tests are available in `tests/test_webhook.py`.

To run the tests:

[source,bash]
----
python3 roles/ocp4_workload_ocp_console_embed/tests/test_webhook.py
----
